function pricePreview(){var e=document.getElementById("product_price").value,t=document.getElementById("tax_rate").value;t=t.replace("%","");if(!isFinite(t)||isNaN(parseFloat(t))||parseFloat(t)<0)t=0;if(isFinite(e)&&!isNaN(parseFloat(e))&&parseFloat(e)>=0){var n=e*(1+t/100),r=n.toString(),i=r.indexOf(".");n<1?i==-1?document.getElementById("preview_price").innerHTML=n+".00":document.getElementById("preview_price").innerHTML=n.toPrecision(2):i>0?document.getElementById("preview_price").innerHTML=n.toPrecision(i+2):i==-1?document.getElementById("preview_price").innerHTML=n+".00":document.getElementById("preview_price").innerHTML=n.toPrecision(e.length+2)}}function generateShortDescription(){var e="",t=document.getElementById("full_description").value;if(document.getElementById("full_description")){var n=mb_strlen(t);document.getElementById("description_count").innerHTML=21e3-n+" characters remaining";n>21e3?document.getElementById("description_count").setAttribute("class","wp-error"):document.getElementById("description_count").setAttribute("class","wp-message")}var r=document.createElement("DIV");r.innerHTML=t;r.textContent?t=r.textContent:r.innerText&&(t=r.innerText);e=t.replace(/(\r\n|\n|\r)/gm," ").replace(/\s+/g," ").substr(0,150);document.getElementById("short_description").value=e;var i=150-document.getElementById("short_description").value.length;document.getElementById("short_character_count").innerHTML=i;document.getElementById("short_character_term").innerHTML=i==1?"character":"characters";i<0&&document.getElementById("short_character_count").parentNode.setAttribute("class","alert-danger")}function mb_strlen(e){var t=0;for(var n=0;n<e.length;n++)t+=e.charCodeAt(n)<0||e.charCodeAt(n)>255?2:1;return t}if(document.getElementById("preview_price")){document.getElementById("product_price").onkeyup=pricePreview;document.getElementById("tax_rate").onkeyup=pricePreview}jQuery(function(e){e("fieldset").each(function(t){e(".aside-25").find("li").eq(t).data("ind",t);e(this).data("ind",t);t>0&&!e(this).hasClass("notoggle")?e(this).slideUp():e(this).addClass("open")});e("a.step").on("click",function(t){t.preventDefault();var n=e(this);e(".aside-25").find("li").eq(n.data("step")).click()});e(".aside-25").on("click","li",function(){var t=e(this);e("fieldset.open").removeClass("open").slideUp("normal",function(){e(".aside-25").find(".active").removeClass("active");t.addClass("active");e("fieldset").eq(t.data("ind")).addClass("open").slideDown("normal",function(){e("html, body").animate({scrollTop:e(".aside-25").offset().top},100)})})});if(document.getElementById("product_title").length>0){var t=140-mb_strlen(document.getElementById("product_title").val.length),n="text-right wrap";t<0&&(n+=" error");e("#product_title").after('<span class="'+n+'">'+t+" characters remaining</span>").keyup(function(){var t=140-mb_strlen(this.val.length);t<0?e(this).next("span").addClass("error"):e(this).next("span").removeClass("error");e(this).next("span").text(t+" characters remaining")})}var r=!1,i=!1,s=0;e("#product_form").on("click",'input[type="submit"]',function(t){e("#product_form").data("e",e(this))});e("#product_form").on("submit",function(t){r!==!1&&r.abort();if(!0===dropper.uploading){var n=confirm("Some images have not finished uploading. If you choose to continue, you may lose these images. Continue?");if(!1===n)return!1}e(this).data("e").hasClass("publish")?document.getElementById("enabled_yes").checked=!0:e(this).data("e").hasClass("unpublish")&&(document.getElementById("enabled_no").checked=!0);e("#message").length==1&&e("#message").html("");var o=[];e(".cats").length>0&&e(".cats").each(function(){if(e(this).is(":checked")){prnt=e(this).data("parent");var t=!0;while(t===!0){e("#cat_"+prnt).prop("checked",!0);prnt=e("#cat_"+prnt).data("parent");prnt==undefined&&(t=!1)}}});e(".cats").length>0&&e(".cats:checked").length==0&&o.push("Please select a category");var u=document.getElementById("tax_rate").value;if(u!=""&&u!=undefined){u=u.replace("%","");u=u.replace(/\s+/g,"");(!isFinite(u)||isNaN(parseFloat(u))||parseFloat(u)<0)&&o.push("Please enter a tax rate so we can determine the tax to display on invoices")}e("#product_title").val().replace(/\s+/g,"")==""&&o.push("Please enter a title");if(!1===document.getElementById("unlimited").checked){var a=e("#product_quantity").val();(a.replace(/\s+/g,"")==""||!isFinite(a)||isNaN(parseInt(a))||a.indexOf(".")>-1||a.indexOf(",")>-1)&&o.push('Please enter the quantity available as a number (without "." or ",")')}var f=e("#product_price").val();(!isFinite(f)||isNaN(parseFloat(f)))&&o.push("Please enter a price, make sure you only use numbers and full stops");if(e("#discount_type").is(":checked")){var l=e("#discount_value").val();(l.replace(/\s+/g,"")==""||!isFinite(l)||isNaN(parseInt(l))||l.indexOf(".")>-1||l.indexOf(",")>-1)&&o.push("Please enter a discount value")}if(o.length>0){t.preventDefault();if(e("#message").length==0){var c=e('<div id="message"></div>');e(".page-article-part").find("form").eq(0).prepend(c)}else var c=e("#message");for(var h in o)c.append('<p class="wp-error">'+o[h]+"</p>");overlay.setHeader("Oops, sorry there were errors");c=[];for(var h in o)c.push(o[h]);overlay.setBody("Please see the error messages and fill in the required fields:<br><br>"+c.join("<br>"));overlay.populateInner();return!1}if(e(this).data("e").hasClass("preview")){overlay.setHeader("Crunching images and saving...");overlay.setBody("Please wait while we save your product and upload your images...");overlay.populateInner();e(this).find("#ajax").length==0?e(this).append('<input type="hidden" id="ajax" name="preview" value="1">'):e(this).find("#ajax").val("1");var p=e(this).serialize();r=e.ajax({url:e(this).prop("action"),type:"post",data:p,success:function(t){if(t.error===!1&&t.data&&t.data.location){overlay.setHeader("Saved!");overlay.setBody('Preview should open in a new window. If your preview does not open <a href="'+t.data.location+'" target="_blank" class="btn btn-primary">Click here to manually open it.</a>');overlay.populateInner();i=window.open(t.data.location,"_blank");setTimeout(function(){s=setInterval(function(){if(i==null||i.closed){overlay.close();clearInterval(s);e.ajax("/shop/dashboard/preview_close/")}},100)},1e4)}else{overlay.setHeader("Oops!");var n="";for(var r in t.data.errors)n+=t.data.errors[r]+"<br>";overlay.setBody("There was an error making the preview... Please contact us: Error information: ".str);overlay.populateInner()}return},error:function(e){if(e.status>0){overlay.setHeader("Oops!");overlay.setBody("there was a problem making your preview. Please make sure you have filled out all the required fields");overlay.populateInner()}else overlay.close()}});t.preventDefault();return!1}e(this).find("#ajax").val("0").remove()})});var product_options_count=0,sizer=function(){this.obj=[];this.setObj=function(e){this.obj=e};this.getSize=function(){var e=0;for(var t in this.obj)this.obj.hasOwnProperty(t)&&e++;return e};this.getElementAt=function(e){if(e!=undefined){var t=0;for(var n in this.obj)if(this.obj.hasOwnProperty(n)){if(t==e)return this.obj[n];t++}}return!1}};document.getElementById("unlimited").onclick=function(){var e=this.checked;e===!0?document.getElementById("product_quantity").style.visibility="hidden":document.getElementById("product_quantity").style.visibility="visible"};document.getElementById("add_product_variation")&&(document.getElementById("add_product_variation").onclick=function(){var e=document.getElementById("variation_cost").value,t=document.getElementById("variation_name").value,n=document.getElementById("variation_availability").value;switch(currency){default:e=e.replace("\u00a3","").replace(currency,"");break;case"&dollar;":e=e.replace("$","").replace(currency,"")}document.getElementById("option_cost_error").setAttribute("class","hidden wp-error");document.getElementById("option_availability_error").setAttribute("class","hidden wp-error");document.getElementById("option_name_error").setAttribute("class","hidden wp-error");error=!1;if(e.replace(/\s/g,"")==""||isNaN(parseFloat(e))){document.getElementById("option_cost_error").innerHTML="Please enter a price";document.getElementById("option_cost_error").setAttribute("class","wp-error");error=!0}if(t.replace(/\s/g,"")==""){document.getElementById("option_name_error").innerHTML="Please enter a name";document.getElementById("option_name_error").setAttribute("class","wp-error");error=!0}if(isNaN(parseInt(n))){document.getElementById("option_availability_error").innerHTML="Please enter the quantity available";document.getElementById("option_availability_error").setAttribute("class","wp-error");error=!0}if(error===!1){var r=document.createElement("li"),i=document.createElement("span");i.setAttribute("class","close");i.innerHTML="x";r.innerHTML='<span class="option-name">'+t+'</span><span class="option-price"> '+currency+parseFloat(e)+'</span> <span class="option-availability">'+parseInt(n)+" available</span>"+'<input type="hidden" name="product_option_new['+product_options_count+'][name]" value="'+encodeURI(t)+'">'+'<input type="hidden" name="product_option_new['+product_options_count+'][price]" value="'+parseFloat(e)+'">'+'<input type="hidden" name="product_option_new['+product_options_count+'][availability]" value="'+parseInt(n)+'">';product_options_count++;r.appendChild(i);i.onclick=function(){document.getElementById("product_options").removeChild(this.parentNode)};document.getElementById("product_options").appendChild(r);this.disabled=!0;this.value="Option Added!";var s=this;setTimeout(function(){document.getElementById("variation_cost").value="";document.getElementById("variation_name").value="";document.getElementById("variation_availability").value="";s.disabled=!1;s.value="Add Option"},500)}return!1});if(document.getElementsByClassName("close").length>0)for(var x in document.getElementsByClassName("close"))document.getElementsByClassName("close")[x].onclick=function(){document.getElementById("product_options").removeChild(this.parentNode)};document.getElementById("product_type")&&(document.getElementById("product_type").onchange=function(){var e=document.getElementsByClassName("product-type-group");this.value==2?document.getElementById("product_type_label").style.display="block":document.getElementById("product_type_label").style.display="none";this.value!=1&&(document.getElementById("download_elsewhere").value="");for(var t=0;t<e.length;t++)t+1!=this.value?e[t].setAttribute("class","product-type-group form-group hidden"):e[t].setAttribute("class","product-type-group form-group")});document.getElementById("populate_seo").onclick=generateShortDescription;document.getElementById("discount_value").onkeyup=function(){this.value=this.value.replace(/[^0-9.]/g,"")};jQuery(function(e){function t(t){var n=e(this),r=0;if(this.checked===!0){r=e(this).data("parent");var i=!0;while(i===!0){e("#cat_"+r).prop("checked",!0);r=e("#cat_"+r).data("parent");r==undefined&&(i=!1)}}else e(this).parent().parent().find("ul").length>0&&e(this).parent().parent().find("ul").find("input").prop("checked",!1)}e(".cats").length>0&&e(".cats").on("change",t);document.getElementById("product_type").value==5&&jQuery(".date").datepicker({dateFormat:"yy-mm-dd"});e('[name="download_location"]').on("change",function(){if(e(this).is(":checked")){var t=e(this).val();if(t==1){e("#withus").hide();e("#elsewhere").show()}else{e("#withus").show();e("#elsewhere").hide()}}})});