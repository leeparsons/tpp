var fbLogin={path:"",on_login_page:!1,discover:!0,me:0,me_data:[],ajaxRequest:!1,callback:!1,getMe:!1,on_application_form:!1,init:function(){fbLogin.getInitLoginStatus();jQuery(".fb-login-button-a, .btn-facebook").live("click",function(e){e.preventDefault();fbLogin.discover=!1;fbLogin.getFBLoginStatus(!0,!1)});FB.Event.subscribe("auth.login",fbLogin.authResponse);var e=window.location.pathname.split("/"),t=e[e.length-1];t==""&&e.length>2&&(t=e[e.length-2]);this.path=t;switch(t){case"store_login":case"store_register":fbLogin.on_login_page=!0;break;case"sell-with-us":fbLogin.on_application_form=!0;break;default:}},getFBLoginStatus:function(trigger_login,callback){callback!=undefined&&(fbLogin.callback=callback);if(fbLogin.me==0){trigger_login===!0?fbLogin.getMe=!0:fbLogin.getMe=!1;FB.login(fbLogin.authResponse,{scope:"email,user_friends"});return}trigger_login&&fbLogin.sendFBLoginRequest()},getInitLoginStatus:function(){FB.getLoginStatus(function(e){e.status==="connected"&&(fbLogin.me=e.authResponse.userID)},{scope:"email,user_friends"})},triggerAuthLogin:function(){FB.login(fbLogin.authResponse,{scope:"email,user_friends"})},sendFBLoginRequest:function(callback){callback!=undefined&&(fbLogin.callback==undefined||fbLogin.callback===!1)&&(fbLogin.callback=callback);FB.api("/me",function(response){fbLogin.me_data=response;fbLogin.me=response.id;!1!==fbLogin.ajaxRequest&&fbLogin.ajaxRequest.abort();if(!0===fbLogin.on_login_page){var div=document.createElement("div");jQuery(div).css({padding:"5%",width:"100%"});overlay.setHeader("Hello!");overlay.setBody("<p>Good to see you, "+response.first_name+"!<br><br>Please wait while we log you into our store...<br><br></p>");overlay.setCloseLink(!1);overlay.populateInner();fbLogin.ajaxRequest=jQuery.ajax({url:"/shop/store_register/fb/ajax/",type:"POST",dataType:"json",cache:!1,data:{fname:response.first_name,lname:response.last_name,_email:response.email,fid:response.id,gender:response.gender,profile_link:response.link,application_form:fbLogin.on_application_form},success:function(data){if(!0===fbLogin.on_login_page)if(data.message){overlay.setHeader(data.message.header);overlay.setBody(data.message.body);overlay.populateInner();if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}}else if(data.error){overlay.setHeader("Oops!");overlay.setBody(data.status);overlay.setCloseLink(!1);overlay.populateInner();if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}}else if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}else window.location.href=data.redirect;else{if(!data.error){if(data.popup&&data.popup.name){var popup_text="Welcome back "+data.popup.name;popup.setText(popup_text);popup.show()}fbLogin.replaceMenu(data)}if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}}},error:function(e){e.readyState!=0&&console.log("error occurred",e)}})}else fbLogin.ajaxRequest=jQuery.ajax({url:"/shop/store_register/fb/ajax/",type:"POST",dataType:"json",cache:!1,data:{discover:fbLogin.discover===!0?1:0,fname:response.first_name,lname:response.last_name,_email:response.email,fid:response.id,gender:response.gender,profile_link:response.link,application_form:fbLogin.on_application_form},success:function(data){if(!0===fbLogin.on_login_page)if(data.message){overlay.setHeader(data.message.header);overlay.setBody(data.message.body);overlay.setCloseLink(data.redirect);overlay.populateInner();if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}}else if(data.error){overlay.setHeader("Oops!");overlay.setBody(data.status);overlay.setCloseLink(!1);overlay.populateInner();if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}}else if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}else window.location.href=data.redirect;else{if(!data.error){if(data&&data.popup&&data.popup.name){var popup_text="Welcome back "+data.popup.name;popup.setText(popup_text);popup.show()}fbLogin.replaceMenu(data)}if(fbLogin.callback!==!1){var cb=fbLogin.callback;fbLogin.callback=!1;eval(cb)}}},error:function(e){e.readyState!=0&&console.log("error",e)}})},{scope:"email,user_friends"})},authResponse:function(response){if(typeof response.authResponse!==undefined&&response.authResponse&&typeof response.authResponse.accessToken!==undefined&&typeof response.authResponse.userID!==undefined&&typeof response.status!==undefined){fbLogin.me=response.authResponse.userID;fbLogin.getMe===!0&&response.status=="connected"?fbLogin.sendFBLoginRequest():fbLogin.callback!==!1&&eval(fbLogin.callback)}else fbLogin.callback!==!1&&eval(fbLogin.callback)},replaceMenu:function(e){fbLogin.on_application_form===!0&&(fbLogin.callback==undefined||fbLogin.callback===!1)&&fbApply.fbStatus();jQuery(".menu-btns").find(".login-btn").eq(0).remove();jQuery(".menu-btns").find(".btn-facebook").remove();jQuery(".menu-btns").find(".or").remove();e.link_text&&e.link_text=="My Dashboard"&&jQuery(".menu-btns").find(".sell").prop("href","/shop/dashboard/product/new").text("List a product");jQuery(".menu-btns").find("a:first").after('<a href="'+e.redirect+'">'+(e.link_text?e.link_text:"My Account")+"</a>");jQuery(".menu-btns").find("a:last").before('<a href="/shop/store_logout" class="logout-btn btn btn-danger">Logout</a>')}},overlay={overlay:!1,header:"",body:"",close_link:!1,init:function(){overlay.overlay=jQuery("<div></div>");overlay.overlay.prop("id","overlay");overlay.overlay.css({opacity:0,zIndex:-1});overlay.overlay.on("click",overlay.close);overlay.header=document.createElement("h3");overlay.body=document.createElement("p");jQuery("body").append(overlay.overlay)},setCloseLink:function(e){overlay.close_link=e},setHeader:function(e){overlay.header.innerHTML=e},setBody:function(e){overlay.body.innerHTML=e},populateInner:function(e){if(jQuery(".overlay-inner").length==1){var t=jQuery(".overlay-inner");t.html("")}else{var t=jQuery("<div></div>");t.prop("class","overlay-inner")}var n=document.createElement("a");jQuery(n).on("click",overlay.close);jQuery(n).addClass("close");t.append(n);t.css("z-index",5003);var r=jQuery("<div></div>");r.css({padding:"5%"}).addClass("wrap").append(overlay.header,overlay.body);t.append(r);e==undefined&&(e=jQuery(window).scrollTop()*1.2);e==0&&(e="100px");t.css("top",e);overlay.overlay.animate({opacity:.55},500).css("z-index",5e3);jQuery("body").append(t).css({overflow:"hidden"})},close:function(e){e!==undefined&&e.preventDefault();!1!==overlay.close_link&&(window.location.href=overlay.close_link);overlay.overlay.animate({opacity:0},500).css({zIndex:-1});jQuery(".overlay-inner").fadeOut("fast",function(){jQuery(".overlay-inner").remove()});jQuery("body").css({overflow:"visible"})}},popup={text:"",to:0,popup:"",init:function(){popup.popup=jQuery("<div></div>");popup.popup.prop("class","popup");popup.popup.hide();jQuery("body").append(popup.popup);popup.popup.fadeOut();var e=jQuery("<a></a>");e.prop("class","close");e.on("click",popup.close);var t=document.createElement("p");popup.popup.append(e,t)},setText:function(e){popup.text=e},show:function(){popup.popup.find("p").html(popup.text);popup.popup.show();popup.popup.fadeIn();popup.to=setTimeout(popup.close,2e3)},close:function(e){e!==undefined&&e.preventDefault();clearTimeout(popup.to);popup.popup.fadeOut("normal",popup.hide)},hide:function(){clearTimeout(popup.to);popup.popup.hide()}};jQuery(document).ready(function(e){function t(){FB.init({appId:"270470249767149",status:!0,xfbml:!0});e(document).trigger("facebook:ready")}e(document).on("facebook:ready",fbLogin.init);window.FB?t():window.fbAsyncInit=t;popup.init();overlay.init()});