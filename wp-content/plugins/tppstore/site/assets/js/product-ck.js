jQuery(function(e){e.fn.slideHeightAdjust=function(t){var n=e("#product_images .slides").width()*1,r=e("#product_images .slides").height()*1,i=0,s=0,o=0,u=0;e(this).find("img").each(function(a){var f=e(this);f.data("ind",a);i=e(this).get(0).clientWidth;s=e(this).get(0).clientHeight;if(s>r){o=r/s;s=r;i=o*i;u=0}else u=(r-s)/2;e(this).css({width:i,height:s,top:u});i=e(this).get(0).clientWidth;i<n&&e(this).css({left:(n-i)/2});t===!0&&a>0&&f.fadeOut().removeClass("vhidden")})};e.fn.setUpSlides=function(){for(var t=0;t<e(this).find("img").length;t++)e(this).find("img").eq(t).data("ind",t);e(this).on("click","img",function(){var t=e(".slide-navigation").find(".active");t.css("opacity",.5);e(this).css("opacity",1).addClass("active");e(".slides").find("img.active").fadeOut().removeClass("active");e(".slides").find("img").eq(e(this).data("ind")).fadeIn().addClass("active")})};e(".slides").ready(function(){e(".slides").slideHeightAdjust(!0)});e(".slide-navigation").ready(function(){e(".slide-navigation").setUpSlides()})});window.onresize=function(){jQuery(".slides").slideHeightAdjust(!1)};var fbDiscounts={init:function(){document.getElementById("fb_share")&&(document.getElementById("fb_share").onclick=fbDiscounts._click);document.getElementById("f_click")&&(document.getElementById("f_click").onclick=fbDiscounts._fClick)},_authResponse:function(e){console.log("authorisation response on fbDiscounts")},_getDiscountCode:function(){overlay.setBody("Please wait while we retrieve your discount code");overlay.setHeader("Fetching Discount Code");overlay.populateInner();jQuery.ajax({url:"/shop/discounts/make/",data:{product:document.getElementById("product").value,fb_user_id:fbLogin.me},method:"POST",cache:!1,success:fbDiscounts._codeRetrieved,error:fbDiscounts._codeRetrievalFailed})},_codeRetrievalFailed:function(e){overlay.setBody("There was a problem retrieving your discount code. Please contact us.");overlay.setHeader("Sorry!");overlay.populateInner()},_codeRetrieved:function(e){if(e.error===!0){e.status&&e.status!=""?overlay.setBody(e.status):overlay.setBody("There was an error getting your discount code!<br><br>Please contact us.");overlay.setHeader("Oops!")}else{overlay.setBody("Your discount has been added to your cart for this product!<br><br>All you need to do is add this product to your cart and the discount will be applied automatically!");overlay.setHeader("Congratulations!")}overlay.populateInner()},showShare:function(){console.log(main_image);FB.ui({method:"feed",name:title,link:permalink,picture:main_image,caption:"",description:description,message:""},function(e){e&&e.post_id?FB.api("https://graph.facebook.com/"+e.post_id,"get",function(e){if(!e||e.error){overlay.setHeader("Opps!");overlay.setBody("We could not detect a public share, sorry. Please make sure you make a public share!");overlay.populateInner()}else{overlay.setHeader("Updating ...");overlay.setBody("Thank you for sharing, please bear with us while we retrieve your one time discount code...");overlay.populateInner();jQuery.ajax({url:"/shop/discounts/create/",type:"post",data:{post_id:e.post_id,product:document.getElementById("product").value},success:fbDiscounts._codeRetrieved,error:fbDiscounts._codeRetrievalFailed})}}):alert("You would have got a discount code if you shared!.")})},validateLogin:function(e){if(e.status=="connected"){overlay.setBody("Share this product on your facebook wall to receive your discount");overlay.setCloseLink(!1);overlay.setHeader("Social Share Discount");overlay.populateInner();fbDiscounts.showShare()}else if(e.status=="not_authorized"){overlay.setHeader("Oops");overlay.setBody("I detected you have not authorized The Photography Parlour Store on Facebook.<br><br>You can allow The Photography Parlour access in your Facebook privacy settings.<br><br>This popup will automatically close in 7 seconds");overlay.setCloseLink(!1);overlay.populateInner();setTimeout(overlay.close,7e3)}else{overlay.setHeader("Oops");overlay.setBody("I detected you cancelled the login... <br><br>This popup wil automaticaly close in 4 seconds");overlay.setCloseLink(!1);overlay.populateInner();setTimeout(overlay.close,4e3)}},_click:function(){overlay.setBody("Please wait while we detect your social status...");overlay.setCloseLink(!1);overlay.setHeader("Social Share Discount");overlay.populateInner();fbLogin.me===0?setTimeout(function(){FB.login(fbDiscounts.validateLogin,{scope:"email,user_friends"})},500):fbDiscounts.validateLogin({status:"connected"});return!1},_fClick:function(){FB.login(fbDiscounts.authResponse,{scope:"email,user_friends"});return!1}},fbFriends={init:function(){fbLogin.me>0&&fbFriends.status()},status:function(){fbLogin.me&&fbLogin.me!==shop_fb_id&&FB.api("/me/mutualfriends/"+shop_fb_id+"?limit=10000&offset=0",fbFriends.friends)},friends:function(e){if(e&&!e.error&&e.data.length>0){var t,n=document.getElementById("facebook_friends");t=document.createElement("h5");jQuery(t).text("Mutual Friends").addClass("indent align-left wrap");n.appendChild(t);for(var r=0;r<5;r++){t=document.createElement("img");t.setAttribute("src","http://graph.facebook.com/"+e.data[r].id+"/picture?type=square");n.appendChild(t)}t=document.createElement("span");jQuery(t).text(" and "+e.data.length+" more");n.appendChild(t)}}};jQuery(document).ready(function(e){e(document).on("facebook:ready",function(){fbDiscounts.init();fbFriends.init()})});