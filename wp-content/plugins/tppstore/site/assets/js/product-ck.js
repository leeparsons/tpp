jQuery(function(e){e.fn.slideHeightAdjust=function(t){e(this).find("img").each(function(n){t===!0&&n>0&&e(this).fadeOut().removeClass("vhidden")});return;var n,r,i,s,o,u,a};e.fn.setUpSlides=function(){for(var t=0;t<e(this).find("img").length;t++)e(this).find("img").eq(t).data("ind",t);e(this).on("click","img",function(){var t=e(".slide-navigation").find(".active");t.css("opacity",.5);e(this).css("opacity",1).addClass("active");e(".slides").find("img.active").fadeOut().removeClass("active");e(".slides").find("img").eq(e(this).data("ind")).fadeIn().addClass("active")})};e(".slides").ready(function(){e(".slides").slideHeightAdjust(!0)});e(".slide-navigation").ready(function(){e(".slide-navigation").setUpSlides()});var t=!1,n=e(".email-share").on("click",function(){if(t===!1){t=document.createElement("div");var n=document.createElement("form");n.setAttribute("action","/shop/email_friend/");n.setAttribute("id","email_send_form");var r=document.createElement("input");r.setAttribute("type","submit");r.setAttribute("class","btn btn-primary");r.value="Send";var i=document.createElement("div");i.setAttribute("id","email_errors");i.style.display="none";var s=document.createElement("div");s.setAttribute("class","form-group");n.appendChild(i);var o=document.createElement("label");o.setAttribute("for","friend_email");o.innerHTML="Friends email:";var u=document.createElement("input");u.setAttribute("name","femail");u.setAttribute("placeholder","Friend's Email");u.setAttribute("id","friend_email");u.setAttribute("class","form-control");s.appendChild(o);s.appendChild(u);n.appendChild(s);var a=document.createElement("div");a.setAttribute("class","form-group");var f=document.createElement("label");f.setAttribute("for","from");f.innerHTML="Your name:";var l=document.createElement("input");l.setAttribute("name","from");l.setAttribute("placeholder","Your Name");l.setAttribute("id","from");l.setAttribute("class","form-control");a.appendChild(f);a.appendChild(l);n.appendChild(a);var c=document.createElement("div");c.setAttribute("class","form-group");c.appendChild(r);n.appendChild(c);t.appendChild(n);e("#email_send_form").live("submit",function(t){t.preventDefault();e("#email_errors").hide().html("");var n=[],r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;""==e("#from").val().replace(/\s+/g,"")&&n.push("Please enter your name");!1===r.test(e("#friend_email").val())&&n.push("Please make sure your friend's email address is valid");if(n.length>0){t.preventDefault();for(var i=0;i<n.length;i++)e("#email_errors").append('<p class="wp-error">'+n[i]+"</p>").show()}else e.post("/shop/email_share/",{from:e("#from").val(),femail:e("#friend_email").val(),p:e("#product").val()},function(){e("#email_send_form").find("div.form-group").slideUp();e("#email_errors").html("").show().html('<p class="wp-message">Your share has been sent!</p>')})})}else e("#email_send_form").find("div.form-group").slideDown();overlay.setBody(t.innerHTML);overlay.setHeader("Send to a friend");overlay.populateInner()})});window.onresize=function(){jQuery(".slides").slideHeightAdjust(!1)};var fbDiscounts={init:function(){document.getElementById("fb_share")&&(document.getElementById("fb_share").onclick=fbDiscounts._click);document.getElementById("f_click")&&(document.getElementById("f_click").onclick=fbDiscounts._fClick)},_authResponse:function(e){console.log("authorisation response on fbDiscounts")},_getDiscountCode:function(){overlay.setBody("Please wait while we retrieve your discount code");overlay.setHeader("Fetching Discount Code");overlay.populateInner();jQuery.ajax({url:"/shop/discounts/make/",data:{product:document.getElementById("product").value,fb_user_id:fbLogin.me},method:"POST",cache:!1,success:fbDiscounts._codeRetrieved,error:fbDiscounts._codeRetrievalFailed})},_codeRetrievalFailed:function(e){overlay.setBody("There was a problem retrieving your discount code. Please contact us.");overlay.setHeader("Sorry!");overlay.populateInner()},_codeRetrieved:function(e){if(e.error===!0){e.status&&e.status!=""?overlay.setBody(e.status):overlay.setBody("There was an error getting your discount code!<br><br>Please contact us.");overlay.setHeader("Oops!")}else{overlay.setBody("Your discount has been added to your cart for this product!<br><br>All you need to do is add this product to your cart and the discount will be applied automatically!");overlay.setHeader("Congratulations!")}overlay.populateInner()},showShare:function(){console.log(main_image);FB.ui({method:"feed",name:title,link:permalink,picture:main_image,caption:"",description:description,message:""},function(e){if(e&&e.post_id)if(!e||e.error){overlay.setHeader("Opps!");overlay.setBody("We could not detect a public share, sorry. Please make sure you make a public share!");overlay.populateInner()}else{overlay.setHeader("Updating ...");overlay.setBody("Thank you for sharing, please bear with us while we retrieve your one time discount code...");overlay.populateInner();jQuery.ajax({url:"/shop/discounts/create/",type:"post",data:{post_id:e.post_id,product:document.getElementById("product").value},success:fbDiscounts._codeRetrieved,error:fbDiscounts._codeRetrievalFailed})}})},validateLogin:function(e){if(e.status=="connected"){overlay.setBody("Share this product on your facebook wall to receive your discount");overlay.setCloseLink(!1);overlay.setHeader("Social Share Discount");overlay.populateInner();fbDiscounts.showShare()}else if(e.status=="not_authorized"){overlay.setHeader("Oops");overlay.setBody("I detected you have not authorized The Photography Parlour Store on Facebook.<br><br>You can allow The Photography Parlour access in your Facebook privacy settings.<br><br>This popup will automatically close in 7 seconds");overlay.setCloseLink(!1);overlay.populateInner();setTimeout(overlay.close,7e3)}else{overlay.setHeader("Oops");overlay.setBody("I detected you cancelled the login... <br><br>This popup wil automaticaly close in 4 seconds");overlay.setCloseLink(!1);overlay.populateInner();setTimeout(overlay.close,4e3)}},_click:function(){overlay.setBody("Please wait while we detect your social status...");overlay.setCloseLink(!1);overlay.setHeader("Social Share Discount");overlay.populateInner();fbLogin.me===0?setTimeout(function(){FB.login(fbDiscounts.validateLogin,{scope:"email,user_friends"})},500):fbDiscounts.validateLogin({status:"connected"});return!1},_fClick:function(){FB.login(fbDiscounts.authResponse,{scope:"email,user_friends"});return!1}},fbFriends={watcher:0,init:function(){FB.getLoginStatus(function(e){e.status&&e.status=="connected"&&(fbLogin.me=e.authResponse.userID)});fbFriends.watcher=setInterval(function(){if(fbLogin.me>0){clearInterval(fbFriends.watcher);fbFriends.status()}},500)},status:function(){fbLogin.me&&fbLogin.me!==shop_fb_id&&shop_fb_id>0&&FB.api("/me/mutualfriends/"+shop_fb_id+"?limit=10000&offset=0",fbFriends.friends)},friends:function(e){console.log(e);if(e&&!e.error&&e.data.length>0){var t,n=document.getElementById("facebook_friends");t=document.createElement("h5");jQuery(t).text("Mutual Friends").addClass("indent align-left wrap");n.appendChild(t);for(var r=0;r<5;r++){t=document.createElement("img");t.setAttribute("src","http://graph.facebook.com/"+e.data[r].id+"/picture?type=square");n.appendChild(t)}t=document.createElement("span");jQuery(t).text(" and "+e.data.length+" more");n.appendChild(t)}}};jQuery(document).ready(function(e){e(document).on("facebook:ready",function(){fbDiscounts.init();setTimeout(function(){fbFriends.init()},1e3)})});